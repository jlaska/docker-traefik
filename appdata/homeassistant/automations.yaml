- id: '1617751546799'
  alias: Sunset (interior)
  description: Turn on interior lights when getting dark inside
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: '12.5'
  condition: []
  action:
  - scene: scene.sunset
  - service: frontend.set_theme
    data:
      name: ios-dark-mode-light-blue
  - service: script.ge_switch_led_light
    data:
      node_value: 3
  mode: single
- id: '1617753489001'
  alias: Dawn (exterior)
  description: Turn off exterior lights before dawn
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '-40.0'
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '-18.0'
  condition:
  - alias: Only trigger dawn once a morning
    condition: template
    value_template: '{{ utcnow() - state_attr(''automation.exterior_lights_turn_off'',
      ''last_triggered'') > timedelta(hours=6) }}'
  action:
  - scene: scene.dawn
  mode: single
- id: '1617754756338'
  alias: Good Night (kids)
  description: Kids bedtime
  trigger:
  - platform: time
    at: input_datetime.lights_out_kids
  condition: []
  action:
  - scene: scene.kids_bedtime
  mode: single
- id: '1617838004557'
  alias: Downstairs Activity
  description: 'Downstairs activity triggers when the movie automation is enabled
    and not watching a movie '
  trigger:
  - type: motion
    platform: device
    device_id: 4730e6c001209ad6704136353b3ff8f1
    entity_id: binary_sensor.living_room_motion_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 62f4e5988da089c749d84a512c932b90
    entity_id: binary_sensor.sunroom_motion_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 8a6d52690d1c3c0121c9cf7e526a31a6
    entity_id: binary_sensor.sunroom_protect_motion
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - type: motion
    platform: device
    device_id: 1d4f49c0e8e1bb39d711f96f5f8b8472
    entity_id: binary_sensor.dining_room_motion_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 0064f401138da744f8facb92fea365cc
    entity_id: binary_sensor.mudroom_motion_occupancy
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: 2a5f8fecdec09e90b7bf94fc70d519c8
    entity_id: binary_sensor.kitchen_motion_occupancy
    domain: binary_sensor
  condition:
  - condition: numeric_state
    below: input_number.illumination_medium_cutoff_value
    entity_id: sensor.kitchen_motion_illuminance_lux
  - condition: or
    conditions:
    - condition: state
      entity_id: automation.watching_a_movie
      state: 'off'
    - condition: and
      conditions:
      - condition: state
        entity_id: automation.watching_a_movie
        state: 'on'
      - condition: not
        conditions:
        - condition: state
          entity_id: media_player.family_room_apple_tv
          state: playing
  action:
  - scene: scene.downstairs_motion
  - wait_for_trigger:
    - platform: state
      entity_id: binary_sensor.downstairs_motion_any
      from: 'on'
      to: 'off'
      for: 0:{{states('input_number.time_automation_waits_to_turn_off_after_no_motion_long')|
        int }}:00
    continue_on_timeout: false
  - scene: scene.downstairs_inactivity
  mode: restart
- id: '1617890462942'
  alias: Aeon Minimote Remote Scene Control
  description: ''
  use_blueprint:
    path: freshcoast/zwave-js-aeon-labs-aeotec-minimote.yaml
    input:
      minimote_device: 11a628abf6a5848ed505e5dd3d9cfe26
      button_1_pressed:
      - service: light.toggle
        target:
          entity_id: light.master_bedroom_light
      button_2_pressed:
      - service: light.toggle
        target:
          entity_id: light.master_bedroom_fan_light
      button_3_pressed:
      - service: fan.toggle
        target:
          entity_id: fan.master_bedroom_fan
      button_4_pressed:
      - service: light.toggle
        target:
          entity_id: light.master_bedroom_nightstand
- id: '1617924990879'
  alias: Laundry Room Light - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      target_entity: light.laundry_room_light
      illuminance_cutoff: input_number.illumination_high_cutoff_value
      time_limit_after: input_datetime.time_of_day_automation_start
      time_limit_before: input_datetime.time_of_day_automation_stop
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      motion_sensor: binary_sensor.laundry_room_motion_occupancy
      illuminance_sensor: sensor.master_bedroom_motion_illuminance_lux
- id: '1617925080161'
  alias: Master Bathroom Light - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      target_entity: light.master_bathroom_light
      illuminance_cutoff: input_number.illumination_medium_cutoff_value
      time_limit_after: input_datetime.time_of_day_automation_start
      time_limit_before: input_datetime.time_of_day_automation_stop
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      motion_sensor: binary_sensor.master_bathroom_motion_occupancy
      illuminance_sensor: sensor.master_bedroom_motion_illuminance_lux
- id: '1617970121884'
  alias: Garage Light - Activity
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: db0494415da5d2811883cf44f60faf94
    entity_id: binary_sensor.garage_motion_occupancy
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: 37469d7629aa92d508d96a4d1139ac15
    entity_id: binary_sensor.garage_door_contact
    domain: binary_sensor
  - type: opened
    platform: device
    device_id: c2bd0018417d9382001ed77c17372f2d
    entity_id: binary_sensor.mudroom_door_contact
    domain: binary_sensor
  - type: motion
    platform: device
    device_id: d417ae82a38795b7659c9e75ef829ede
    entity_id: binary_sensor.garage_protect_motion
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - platform: device
    device_id: aca1fd076bac705db6d381d678fe5487
    domain: cover
    entity_id: cover.garage_door_opener
    type: opening
  - platform: device
    device_id: aca1fd076bac705db6d381d678fe5487
    domain: cover
    entity_id: cover.garage_door_opener
    type: opened
  condition: []
  action:
  - service: light.turn_on
    target:
      area_id: mudroom
      entity_id: light.garage_light
  - delay:
      minutes: "{{\n  states('input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion')|int(0)\n\
        }}"
  - wait_template: "{{ is_state('binary_sensor.garage_motion_any', 'off')\n   and\
      \ is_state('binary_sensor.garage_door_contact', 'off')\n   and is_state('binary_sensor.mudroom_door_contact',\
      \ 'off') \n}} "
    continue_on_timeout: false
  - service: light.turn_off
    target:
      entity_id: light.garage_light
  - condition: state
    entity_id: automation.mudroom_activity
    state: 0
    attribute: current
  - service: light.turn_off
    target:
      entity_id: light.mudroom_light
  mode: restart
- id: '1617977378814'
  alias: Downstairs Luminance Above Threshold
  description: When it gets bright outside, turn certain lights off
  trigger:
  - platform: numeric_state
    for: 00:20:00
    entity_id: sensor.kitchen_motion_illuminance_lux
    above: input_number.illumination_medium_cutoff_value
  condition:
  - condition: time
    after: input_datetime.time_of_day_automation_start
    before: '15:00:00'
  action:
  - scene: scene.downstairs_inactivity
  mode: restart
- id: '1618002489309'
  alias: Master Bathroom Button
  description: Toggle lights based on button presses
  use_blueprint:
    path: jlaska/generic_button.yaml
    input:
      mqtt_sensor: sensor.master_bathroom_button_action
      zha_sensor:
      single_action:
      - service: light.toggle
        target:
          entity_id: light.master_bathroom_light
      double_action:
      - service: light.toggle
        target:
          entity_id: light.master_bathroom_shower_light
      hold_action:
      - service: fan.toggle
        target:
          entity_id: fan.master_bathroom_fan
- id: '1618002599661'
  alias: William's Room Button
  description: ''
  use_blueprint:
    path: jlaska/generic_button.yaml
    input:
      mqtt_sensor: sensor.william_s_room_button_action
      single_action:
      - service: light.toggle
        target:
          entity_id: light.williams_room_lamps_zha_group_0x0003
        data:
          transition: 1
          color_temp: 330
          brightness: 255
      double_action:
      - service: light.toggle
        target:
          entity_id: light.williams_room_light
      - service: light.turn_off
        target:
          entity_id: light.william_s_room_fan_light
      hold_action:
      - service: fan.toggle
        target:
          entity_id: fan.williams_room_fan
- id: '1618048885985'
  alias: Spot Lights When Door Opens
  description: Turn on spot lights when exterior door opens at night
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.back_door_contact
    - binary_sensor.front_door_contact
    - binary_sensor.garage_door_contact
    - cover.garage_door_opener
    to:
    - opening
    - 'on'
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.back_spot_light
      - light.front_spot_light
  - wait_template: '{{ states(trigger.entity_id) in [''off'', ''closed''] }}'
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id:
      - light.back_spot_light
      - light.front_spot_light
  mode: restart
- id: '1618075117826'
  alias: Goodbye
  description: Everyone leaves home
  trigger:
  - platform: zone
    entity_id: device_tracker.james_iphone
    zone: zone.home
    event: leave
  - platform: zone
    entity_id: device_tracker.shannons_iphone
    zone: zone.home
    event: leave
  - platform: state
    entity_id: person.kevin_kowalski
    to: not_home
  condition:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: zone
        entity_id: device_tracker.james_iphone
        zone: zone.home
      - condition: zone
        entity_id: device_tracker.shannons_iphone
        zone: zone.home
      - condition: state
        entity_id: device_tracker.kevins_iphone
        state: home
  action:
  - type: turn_off
    device_id: 5364ebdb1d63351833073f854e50a2b6
    entity_id: remote.hubname
    domain: remote
  - service: light.turn_off
    target:
      entity_id: "{% set exclude_light = [\n    'light.back_door_light',\n    'light.front_door_light',\n\
        \    'light.garage_exterior_light',\n    'light.holiday_lights',\n    'light.back_spot_light',\n\
        \    'light.front_spot_light'\n   ] %}\n{%- for device in states.light|selectattr('state','in','on')|rejectattr('entity_id','in',exclude_light)\
        \ -%}\n  {{device.entity_id }}\n  {%- if not loop.last %},{% endif %}\n{%-\
        \ endfor  %}\n"
  - service: fan.turn_off
    target:
      entity_id: all
  mode: single
- id: '1618088888089'
  alias: Good Night
  description: Lights out when quiet at night
  trigger:
  - platform: state
    entity_id: binary_sensor.downstairs_motion_any
    to: 'off'
    for: 0:45:00
  - platform: time
    at:
    - '23:30:00'
    - 00:00:00
    - 00:30:00
    - 01:00:00
    - 01:30:00
  condition:
  - condition: time
    after: input_datetime.goodnight_start_time
    before: input_datetime.goodnight_stop_time
  - condition: state
    entity_id: binary_sensor.downstairs_motion_any
    state: 'off'
    for: 00:45:00
  - condition: template
    value_template: '{{ utcnow() - state_attr(''automation.bed_time'', ''last_triggered'')
      > timedelta(hours=16) }}'
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id:
      - dining_room
      - entryway
      - guest_bathroom
      - guest_room
      - henry_s_room
      - kids_bathroom
      - kitchen
      - laundry_room
      - living_room
      - master_bathroom
      - master_bedroom
      - master_closet
      - mudroom
      - sunroom
      - william_s_room
  - service: fan.turn_off
    target:
      area_id:
      - living_room
      - sunroom
  - service: switch.turn_off
    target:
      entity_id:
      - switch.kitchen_plug_ge_on_off
      - switch.williams_room_plug_ge_on_off
      - switch.holiday_light_switch
  mode: single
- id: '1618103078420'
  alias: Watching A Movie
  description: ''
  trigger:
  - platform: state
    to: playing
    entity_id: media_player.plex_plex_for_apple_tv_family_room
  - platform: state
    entity_id: automation.watching_a_movie
    to: 'on'
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: state
    entity_id: media_player.family_room_apple_tv
    state: playing
  action:
  - service: light.turn_off
    data:
      area_id: living_room
  mode: single
- id: '1618275517438'
  alias: William’s Room - Daytime Inactivity
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: cc8cea0e1b73302c304724df2e6a3ff5
    entity_id: binary_sensor.williams_protect_motion
    domain: binary_sensor
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - platform: time
    at: input_datetime.time_of_day_automation_start
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - condition: state
    entity_id: binary_sensor.williams_protect_motion
    state: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - condition: time
    before: input_datetime.time_of_day_automation_stop
  - alias: Assert sunset was not already triggered today
    condition: template
    value_template: '{{ as_timestamp(state_attr(''automation.sunset'', ''last_triggered''))|timestamp_custom(''%-d'')
      != as_timestamp(now())|timestamp_custom(''%-d'')}}'
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id: william_s_room
  - service: fan.turn_off
    target:
      entity_id: fan.williams_room_fan
  mode: single
- id: '1618275716490'
  alias: Henry’s Room - Daytime Inactivity
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: 63cae940cd0fb6c810fd9accdd273f4b
    entity_id: binary_sensor.henrys_protect_motion
    domain: binary_sensor
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - platform: time
    at: input_datetime.time_of_day_automation_start
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - condition: time
    before: input_datetime.time_of_day_automation_stop
  - condition: state
    entity_id: binary_sensor.henrys_protect_motion
    state: 'off'
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
  - alias: Assert sunset was not already triggered today
    condition: template
    value_template: '{{ as_timestamp(state_attr(''automation.sunset'', ''last_triggered''))|timestamp_custom(''%-d'')
      != as_timestamp(now())|timestamp_custom(''%-d'')}}'
  action:
  - service: light.turn_off
    target:
      area_id: henry_s_room
  - service: fan.turn_off
    target:
      entity_id: fan.henrys_room_fan
  mode: single
- id: '1618704455944'
  alias: Roomba Cycle
  description: ''
  trigger:
  - platform: device
    device_id: 44be43b11976ca9c53539e52847d7cb5
    domain: vacuum
    entity_id: vacuum.roomba
    type: cleaning
  condition:
  - alias: Is it dark in the area?
    condition: or
    conditions:
    - condition: numeric_state
      entity_id: binary_sensor.dining_room_motion_occupancy
      below: input_number.illumination_low_cutoff_value
    - condition: numeric_state
      entity_id: sensor.kitchen_motion_illuminance_lux
      below: input_number.illumination_low_cutoff_value
    - condition: state
      entity_id: sun.sun
      state: below_horizon
  action:
  - scene: scene.robot_start
  - condition: numeric_state
    entity_id: sensor.kitchen_motion_illuminance_lux
    below: '80'
  - service: light.turn_on
    target:
      entity_id:
      - light.living_room_light
      - light.kitchen_light
      - light.entryway_hall_light
      - light.dining_room_light
    data:
      brightness_pct: 100
  - wait_for_trigger:
    - platform: state
      entity_id: vacuum.roomba
      to: docked
      for:
        hours: 1
        minutes: 0
        seconds: 0
        milliseconds: 0
    continue_on_timeout: false
  - condition: state
    entity_id: binary_sensor.downstairs_motion_any
    state: 'off'
  - service: light.turn_off
    target:
      area_id:
      - entryway
      - dining_room
      - kitchen
      - living_room
  mode: restart
- id: '1618877720683'
  alias: Notify Garage Door Open at Sunset
  description: ''
  trigger:
  - platform: sun
    event: sunset
  condition:
  - condition: or
    conditions:
    - condition: device
      device_id: aca1fd076bac705db6d381d678fe5487
      domain: cover
      entity_id: cover.garage_door_opener
      type: is_open
    - type: is_open
      condition: device
      device_id: 37469d7629aa92d508d96a4d1139ac15
      entity_id: binary_sensor.garage_door_contact
      domain: binary_sensor
  action:
  - service: notify.mobile_app_james_iphone
    data:
      title: Garage Door Open
      message: The garage door is still open after sunset
  - service: script.announce
    data:
      entity_id: media_player.all_speakers
      message: The garage door is open after sunset
  mode: single
- id: '1619438138688'
  alias: Mudroom - Activity
  description: Blueprint
  use_blueprint:
    path: freakshock88/motion_illuminance_activated_entity.yaml
    input:
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      target_entity: light.mudroom_light
      turn_off_blocker_entity: light.garage_light
      motion_sensor: binary_sensor.mudroom_motion_occupancy
- id: '1619438720780'
  alias: Back Door - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      illuminance_cutoff: input_number.illumination_low_cutoff_value
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      illuminance_sensor: sensor.kitchen_motion_illuminance_lux
      motion_sensor: binary_sensor.back_door_contact
      target_entity: light.sunroom_fan_light
- id: '1619441985700'
  alias: Front Door - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      target_entity: light.entryway_door_light
      illuminance_cutoff: input_number.illumination_very_low_cutoff_value
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      motion_sensor:
      - binary_sensor.front_door_contact
      - binary_sensor.front_door_protect_doorbell
      illuminance_sensor: sensor.dining_room_motion_illuminance_lux
- id: '1619447091981'
  alias: Dining Room - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      turn_off_blocker_entity: light.entryway_hall_light
      illuminance_cutoff: input_number.illumination_very_low_cutoff_value
      target_entity: light.dining_room_light
      motion_sensor: binary_sensor.dining_room_motion_occupancy
      illuminance_sensor: sensor.dining_room_motion_illuminance_lux
      no_motion_wait: input_number.time_automation_waits_to_turn_off_after_no_motion_medium
- id: '1619530751693'
  alias: Sunrise
  description: ''
  trigger:
  - platform: sun
    event: sunrise
    offset: 00:00:00
  condition: []
  action:
  - service: frontend.set_theme
    data:
      name: default
  - service: light.turn_off
    target:
      area_id: outside
  - service: script.ge_switch_led_light
    data:
      node_value: 2
  mode: single
- id: '1619810016068'
  alias: Kids Bathroom Light - Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      target_entity: light.kids_bathroom_light
      illuminance_cutoff: input_number.illumination_medium_cutoff_value
      time_limit_after: input_datetime.time_of_day_automation_start
      time_limit_before: input_datetime.time_of_day_automation_stop
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      motion_sensor: binary_sensor.kids_bathroom_motion_occupancy
      illuminance_sensor: sensor.kids_bathroom_motion_illuminance_lux
- id: '1620651897512'
  alias: Notify If Any Door Left Open
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.vs553419c_laundry_door
    - binary_sensor.attic_door_contact
    - binary_sensor.back_door_contact
    - binary_sensor.front_door_contact
    - binary_sensor.garage_freezer_door_contact
    - binary_sensor.kitchen_refrigerator_door_contact
    - binary_sensor.mudroom_door_contact
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - service: notify.notify
    data:
      title: The {{ state_attr(trigger.entity_id, 'friendly_name') }} is open
      message: Please close the {{ state_attr(trigger.entity_id, 'friendly_name')
        }}
      data:
        group: notify-door-open
        tag: notify-door-open-{{ trigger.entity_id }}
  - service: script.announce
    data:
      entity_id: media_player.all_speakers
      message: The {{ state_attr(trigger.entity_id, 'friendly_name')|replace(' Contact','')
        }} is open
  - wait_template: '{{ is_state(trigger.entity_id, ''off'') }}'
    timeout: 0:15:00
  - service: notify.notify
    data:
      message: clear_notification
      data:
        tag: notify-door-open-{{ trigger.entity_id }}
  - service: script.announce
    data:
      entity_id: media_player.all_speakers
      message: Thank you
  mode: parallel
  max: 6
- id: '1622157422281'
  alias: Guest Bathroom Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      illuminance_cutoff: input_number.illumination_medium_cutoff_value
      time_limit_after: input_datetime.time_of_day_automation_start
      time_limit_before: input_datetime.goodnight_start_time
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      target_entity: light.guest_bathroom_light
      motion_sensor: binary_sensor.guest_bathroom_motion_occupancy
      illuminance_sensor: sensor.guest_bathroom_motion_illuminance_lux
- id: '1622206147425'
  alias: Notify When Solaredge Offline
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.solaredge_solar_power
    attribute: status
    from: Active,Idle
  - platform: state
    entity_id: device_tracker.solaredge
    to: not_home
  condition:
  - condition: state
    entity_id: sun.sun
    state: above_horizon
  action:
  - service: notify.mobile_app_james_iphone
    data:
      title: Solaredge Offline
      message: The solaredge may be offline ({{trigger.entity_id}} now {{trigger.to_state.status}})
  mode: single
- id: '1622209187653'
  alias: Guest Room Button
  description: ''
  use_blueprint:
    path: jlaska/generic_button.yaml
    input:
      mqtt_sensor: sensor.guest_room_button_action
      zha_sensor:
      single_action:
      - service: light.toggle
        target:
          entity_id: light.guest_room_nightstand
      double_action:
      - service: light.toggle
        target:
          entity_id: light.guest_room_fan_light
      hold_action:
      - service: fan.toggle
        target:
          entity_id: fan.guest_room_fan
- id: '1622336796126'
  alias: Shannon’s Closet Light - Timer
  description: ''
  trigger:
  - platform: state
    entity_id: light.shannon_s_closet_light
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id: light.shannon_s_closet_light
  mode: restart
- id: '1622383389825'
  alias: Dusk (exterior)
  description: Turn on exterior lights at dusk
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: '-2.5'
  condition: []
  action:
  - scene: scene.dusk
  mode: single
- id: '1624216187992'
  alias: Master Bedroom - Daytime Inactivity
  description: Turn off lights and fan when no occupancy detected
  trigger:
  - platform: state
    to: 'off'
    for:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
    entity_id: binary_sensor.master_bedroom_motion_occupancy
  condition:
  - condition: state
    entity_id: sun.sun
    state: above_horizon
  - condition: time
    after: input_datetime.time_of_day_automation_start
    before: input_datetime.time_of_day_automation_stop
  - condition: state
    entity_id: calendar.jlaska_redhat_com
    state: 'off'
  - alias: Assert sunset was not already triggered today
    condition: template
    value_template: '{{ as_timestamp(state_attr(''automation.sunset'', ''last_triggered''))|timestamp_custom(''%-d'')
      != as_timestamp(now())|timestamp_custom(''%-d'')}}'
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id: master_bedroom
  - service: fan.turn_off
    target:
      entity_id: fan.master_bedroom_fan
  mode: restart
- id: '1624216292589'
  alias: Guest Room - Daytime Inactivity
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.guest_room_motion_any
    to: 'off'
    for: 00:30:00
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - platform: time
    at: input_datetime.time_of_day_automation_start
  condition:
  - condition: state
    entity_id: binary_sensor.guest_room_motion_any
    state: 'off'
    for: 00:30:00
  - condition: time
    before: input_datetime.time_of_day_automation_stop
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: '4.0'
  - condition: or
    conditions:
    - condition: state
      entity_id: fan.guest_room_fan
      state: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
    - condition: state
      entity_id: light.guest_room_fan_light
      state: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
    - condition: state
      entity_id: light.guest_room_nightstand
      state: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0
        milliseconds: 0
  - alias: Assert sunset was not already triggered today
    condition: template
    value_template: '{{ as_timestamp(state_attr(''automation.sunset'', ''last_triggered''))|timestamp_custom(''%-d'')
      != as_timestamp(now())|timestamp_custom(''%-d'')}}'
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id:
      - guest_room
      - guest_bathroom
  - service: fan.turn_off
    target:
      area_id: guest_room
  mode: restart
- id: '1624222738706'
  alias: Bathroom Fan/Light Timer
  description: Turn off bathroom lights/fans after a period of time
  trigger:
  - platform: state
    entity_id: fan.powder_room_fan
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    id: powder_room_fan
  - platform: state
    entity_id: light.powder_room_light
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    id: powder_room_light
  - platform: state
    entity_id: light.master_bathroom_toilet_light
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    to: 'on'
    id: master_bathroom_toilet_light
  - platform: state
    entity_id: fan.master_bathroom_toilet_fan
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    id: master_bathroom_toilet_fan
  - platform: state
    entity_id: fan.guest_bathroom_fan
    id: guest_bathroom_fan
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - platform: state
    id: kids_bathroom_fan
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
    entity_id: fan.kids_bathroom_fan
  - platform: state
    entity_id: fan.master_bathroom_fan
    id: master_bathroom_fan
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
      milliseconds: 0
  - platform: state
    entity_id: fan.sunroom_fan
    to: 'on'
    for:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
    id: sunroom_fan
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: trigger
        id: master_bathroom_fan
      - condition: state
        entity_id: binary_sensor.master_bathroom_hygrostat
        state: 'off'
    - condition: and
      conditions:
      - condition: trigger
        id: guest_bathroom_fan
      - condition: state
        entity_id: binary_sensor.guest_bathroom_hygrostat
        state: 'off'
    - condition: and
      conditions:
      - condition: trigger
        id: kids_bathroom_fan
      - condition: state
        entity_id: binary_sensor.kids_bathroom_hygrostat
        state: 'off'
    - condition: and
      conditions:
      - condition: trigger
        id: sunroom_fan
      - condition: state
        state: 'off'
        entity_id: binary_sensor.sunroom_motion_any
    - condition: trigger
      id:
      - master_bathroom_toilet_fan
      - master_bathroom_toilet_light
      - powder_room_fan
      - powder_room_light
  action:
  - service: homeassistant.turn_off
    target:
      entity_id: '{{ trigger.to_state.entity_id }}'
  mode: parallel
  max: 6
- id: '1624750206254'
  alias: Master Bathroom Shower Light - Activity (jlaska)
  description: Turn on Shower light during shower time in the evening
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      motion_sensor: binary_sensor.master_bathroom_motion_occupancy
      target_entity: light.master_bathroom_shower_light
      time_limit_after: input_datetime.time_of_day_shower_automation_start
      time_limit_before: input_datetime.time_of_day_automation_stop
      no_motion_wait: input_number.time_automation_waits_to_turn_off_after_no_motion_medium
- id: '1625665304293'
  alias: Laundry Cycle Finished
  description: Notify when a laundry cycle has finished
  trigger:
  - platform: state
    to: Finished
    for:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
    entity_id:
    - sensor.ms963932g_laundry_machine_state
    - sensor.vs553419c_laundry_machine_state
  condition: []
  action:
  - wait_template: '{{ is_state(trigger.entity_id, ''Off'') }}'
    timeout: 0:02:00
  - service: script.announce
    data:
      message: The {{ trigger.to_state.entity_id == 'sensor.vs553419c_laundry_machine_state'
        and states('sensor.vs553419c_laundry_cycle') or states('sensor.ms963932g_laundry_cycle')
        }} cycle of the {{ state_attr(trigger.to_state.entity_id, 'friendly_name')|replace('State','')|replace('VS553419C','')|replace('MS963932G','')
        }} has finished
      entity_id: media_player.all_speakers
  mode: parallel
  max: 2
- id: '1625752603984'
  alias: Leak Detected
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.laundry_room_leak_water_leak
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_james_iphone
    data:
      message: A leak was detected by {{ state_attr(trigger.to_state.entity_id, 'friendly_name')
        }}
      title: Leak Detected
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
  - type: turn_off
    device_id: b9bea195719b7e53a8ae66a04660c655
    entity_id: switch.laundry_washer_plug_centralite_on_off
    domain: switch
  - service: tts.google_translate_say
    data:
      entity_id: media_player.all_speakers
      message: A leak was detected in the laundry room
  mode: single
- id: '1628526357140'
  alias: Notify When Person Detected
  description: Notify when everyone is away and a person is detected
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door_protect_motion
    attribute: event_object
    to: person
  condition:
  - condition: template
    value_template: '{{ utcnow() - state_attr(''automation.person_notification_when_away'',
      ''last_triggered'') > timedelta(minutes=5) }}'
  action:
  - service: camera.record
    target:
      entity_id: camera.front_door_protect_high
    data:
      lookback: 10
      duration: 15
      filename: /config/www/recording.{{ trigger.entity_id }}.mp4
  - service: camera.snapshot
    target:
      entity_id: camera.front_door_protect_high
    data:
      filename: /config/www/snapshot.{{ trigger.entity_id }}.jpg
  - service: notify.mobile_app_james_iphone
    data:
      title: '{{ trigger.to_state.attributes.event_object|capitalize }} Detected'
      message: '{{ state_attr(trigger.to_state.entity_id, ''friendly_name'') }}'
      data:
        tag: person_detected
        entity_id: camera.front_door_protect_high
        push:
          category: camera
        image: '{{ trigger.to_state.attributes.event_thumbnail }}'
        __image: /local/snapshot.{{ trigger.entity_id }}.jpg
        __video: /local/recording.{{ trigger.entity_id }}.mp4
        actions:
        - action: LIVE
          title: Recorded Event
          uri: /local/recording.{{ trigger.entity_id }}.mp4
  mode: single
- id: '1629366808660'
  alias: Update Available Notification
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.updater
    from: 'off'
    to: 'on'
  action:
  - service: notify.notify
    data:
      message: Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version')
        }} is available.
  - service: notify.persistent_notification
    data:
      title: Home Assistant Update
      message: Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version')
        }} is available ([release notes](state_attr('binary_sensor.updater', 'release_notes'))
  - service: notify.mobile_app_james_iphone
    data:
      title: Home Assistant Update Available
      message: Home Assistant {{ state_attr('binary_sensor.updater', 'newest_version')
        }} is available
      data:
        tag: home_assistant_update
        url: '{{ state_attr(''binary_sensor.updater'', ''release_notes'') }}'
  mode: single
- id: '1629811616934'
  alias: Master Bedroom Ceiling Fan
  description: Turn on/off fan automatically based on temperature and time of day
  trigger:
  - platform: state
    to: 'on'
    for:
      hours: 0
      minutes: 1
      seconds: 0
      milliseconds: 0
    entity_id: binary_sensor.master_bedroom_motion_occupancy
  condition:
  - condition: state
    entity_id: sun.sun
    state: above_horizon
    for:
      hours: 0
      minutes: 0
      seconds: 0
      milliseconds: 0
  - condition: numeric_state
    above: '77.0'
    entity_id: sensor.master_bathroom_weather_temperature
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
    before: '17:00:00'
    after: input_datetime.time_of_day_automation_start
  action:
  - service: fan.turn_on
    target:
      entity_id: fan.master_bedroom_fan
  mode: single
- id: '1630371041263'
  alias: Henry’s Room Button
  description: 'Toggle devices based on button presses '
  use_blueprint:
    path: jlaska/generic_button.yaml
    input:
      mqtt_sensor: sensor.henry_s_room_button_action
      single_action:
      - service: light.toggle
        target:
          entity_id: light.henrys_room_lamps_zha_group_0x0002
        data:
          transition: 1
          brightness: 255
          color_temp: 330
      double_action:
      - service: light.toggle
        target:
          entity_id: light.henrys_room_light
      - service: light.turn_off
        target:
          entity_id: light.henry_s_room_fan_light
      release_action: []
      hold_action:
      - service: fan.toggle
        target:
          entity_id: fan.henrys_room_fan
- id: '1630755323301'
  alias: Piano Time
  description: Turn or/off lights when playing piano
  trigger:
  - type: power
    platform: device
    device_id: 3a590d149622d6333f61fcff22283d9f
    entity_id: sensor.dining_room_plug_samjin_electrical_measurement
    domain: sensor
    above: 0.5
    for:
      hours: 0
      minutes: 0
      seconds: 1
      milliseconds: 0
    id: piano_on
  condition: []
  action:
  - scene: scene.piano_time
  - wait_for_trigger:
    - type: power
      platform: device
      device_id: 3a590d149622d6333f61fcff22283d9f
      entity_id: sensor.dining_room_plug_samjin_electrical_measurement
      domain: sensor
      below: 0.5
      for:
        hours: 0
        minutes: 0
        seconds: 5
        milliseconds: 0
    continue_on_timeout: false
  - service: light.turn_off
    target:
      area_id:
      - dining_room
      - entryway
  mode: restart
- id: '1631050114594'
  alias: Bathroom Humidity Automation
  description: Turn on/off bathroom fans based on humidity sensor state
  trigger:
  - platform: state
    entity_id: binary_sensor.master_bathroom_hygrostat
    from:
    - 'off'
    - 'on'
    to:
    - 'off'
    - 'on'
    id: fan.master_bathroom_fan
  - platform: state
    entity_id: binary_sensor.kids_bathroom_hygrostat
    from:
    - 'off'
    - 'on'
    to:
    - 'off'
    - 'on'
    id: fan.kids_bathroom_fan
  - platform: state
    entity_id: binary_sensor.guest_bathroom_hygrostat
    from:
    - 'off'
    - 'on'
    to:
    - 'off'
    - 'on'
    id: fan.guest_bathroom_fan
  condition:
  - condition: template
    value_template: '{{ trigger.to_state.state != trigger.from_state.state }}'
  action:
  - service: fan.turn_{{ trigger.to_state.state }}
    target:
      entity_id: '{{ trigger.id }}'
  mode: parallel
  max: 4
- id: '1631220675733'
  alias: Notify Zone Geofence
  description: Notify based on who enters and leaves a zone
  trigger:
  - platform: zone
    entity_id:
    - person.james_laska
    - person.shannon_laska
    zone: zone.home
    event: enter
  - platform: zone
    entity_id:
    - person.james_laska
    - person.shannon_laska
    zone: zone.home
    event: leave
  - platform: zone
    entity_id:
    - person.shannon_laska
    zone: zone.ncdg
    event: leave
  - platform: zone
    entity_id:
    - person.james_laska
    zone: zone.rht
    event: leave
  condition: []
  action:
  - alias: Pulse lights
    service: script.zone_geofence_light_pulse
    data:
      trigger_event: '{{ trigger.event }}'
      trigger_zone: '{{ trigger.zone.entity_id }}'
      trigger_person: '{{ trigger.entity_id }}'
  - alias: Send notifications
    service: script.zone_geofence_notification
    data:
      trigger_event: '{{ trigger.event }}'
      trigger_zone: '{{ trigger.zone.entity_id }}'
      trigger_person: '{{ trigger.entity_id }}'
  mode: single
- id: '1632007420377'
  alias: Welcome Back (after dark)
  description: Restart sunset scene if someone returns home after dark.
  trigger:
  - platform: zone
    entity_id:
    - person.james_laska
    - person.shannon_laska
    zone: zone.home
    event: enter
  condition:
  - alias: Before kids lights out
    condition: time
    before: input_datetime.lights_out_kids
  - alias: Sunset automation triggered within the last 3 hours
    condition: template
    value_template: '{{ utcnow() - state_attr(''automation.sunset'', ''last_triggered'')
      < timedelta(hours=3) }}'
  action:
  - scene: scene.sunset
  mode: single
- id: '1633606017424'
  alias: Exterior Door Opens When Dark
  description: Turn on lights if exterior door opens at night
  trigger:
  - type: opened
    platform: device
    device_id: 6a4f4eccc9f68877d56de9d1750e2a78
    entity_id: binary_sensor.front_door_contact
    domain: binary_sensor
    id: front_door
  - type: opened
    platform: device
    device_id: 720f3a84bef7a7dd93aa773ab4767c2a
    entity_id: binary_sensor.back_door_contact
    domain: binary_sensor
    id: back_door
  - type: opened
    platform: device
    device_id: 37469d7629aa92d508d96a4d1139ac15
    entity_id: binary_sensor.garage_door_contact
    domain: binary_sensor
    id: garage_door
  - platform: device
    device_id: aca1fd076bac705db6d381d678fe5487
    domain: cover
    entity_id: cover.garage_door_opener
    type: opened
    id: garage_door
  condition:
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.back_spot_light
      - light.front_spot_light
  - choose:
    - conditions:
      - condition: trigger
        id: front_door
      sequence:
      - service: light.turn_on
        target:
          entity_id:
          - light.front_door_light
          - light.entryway_door_light
    - conditions:
      - condition: trigger
        id: back_door
      sequence:
      - service: light.turn_on
        target:
          entity_id:
          - light.back_door_light
          - light.sunroom_fan_light
    default:
    - service: light.turn_on
      target:
        entity_id:
        - light.back_spot_light
        - light.front_spot_light
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: light.turn_off
    target:
      entity_id:
      - light.back_spot_light
      - light.front_spot_light
  - choose:
    - conditions:
      - condition: trigger
        id: front_door
      sequence:
      - service: light.turn_off
        target:
          entity_id:
          - light.front_door_light
          - light.entryway_door_light
    - conditions:
      - condition: trigger
        id: back_door
      sequence:
      - service: light.turn_off
        target:
          entity_id:
          - light.back_door_light
          - light.sunroom_fan_light
  mode: parallel
  max: 4
- id: '1634814893252'
  alias: Front Door - Exterior Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      illuminance_cutoff: input_number.illumination_very_low_cutoff_value
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
      motion_sensor: binary_sensor.front_door_contact,binary_sensor.front_door_protect_doorbell,binary_sensor.front_door_protect_person
      illuminance_sensor: sensor.dining_room_motion_illuminance_lux
      target_entity: light.front_door_light
      blocker_entity: light.garage_exterior_light
      turn_off_blocker_entity: light.garage_exterior_light
- id: '1638199338566'
  alias: Master Bedroom Button
  description: Aqara Wireless Switch (single, double, hold)
  use_blueprint:
    path: jlaska/generic_button.yaml
    input:
      mqtt_sensor: sensor.master_bedroom_button_action
      zha_sensor:
      single_action:
      - service: light.toggle
        target:
          entity_id: light.master_bedroom_nightstand
      double_action:
      - service: light.toggle
        target:
          entity_id: light.master_bedroom_light
      - service: light.turn_off
        target:
          entity_id: light.master_bedroom_fan_light
      hold_action: []
      release_action:
      - service: fan.toggle
        target:
          entity_id: fan.master_bedroom_fan
- id: '1639618452473'
  alias: Master Bathroom Light Double Tap
  description: ''
  use_blueprint:
    path: kpine/ge_double.yaml
    input:
      device: 98c706574bccaab03950f857a02451d9
      double_tap_on:
      - service: light.turn_on
        target:
          area_id:
          - master_bathroom
          - master_closet
      double_tap_off:
      - service: light.turn_off
        target:
          area_id:
          - master_closet
          - master_bathroom
- id: '1639944886830'
  alias: Williams Room Light Double Tap
  description: ''
  use_blueprint:
    path: kpine/ge_double.yaml
    input:
      device: e886cf686b24935ac3ba4ef19ce35dd9
      double_tap_on:
      - service: light.turn_on
        target:
          area_id: william_s_room
        data:
          color_temp: 330
          brightness: 255
      double_tap_off:
      - service: light.turn_off
        target:
          area_id: william_s_room
- id: '1639947431355'
  alias: Henrys Room Light Double Tap
  description: ''
  use_blueprint:
    path: kpine/ge_double.yaml
    input:
      device: c1607f9a9b672e2ea111d8c56fb3901e
      double_tap_on:
      - service: light.turn_on
        target:
          area_id: henry_s_room
        data:
          color_temp: 330
          brightness: 255
      double_tap_off:
      - service: light.turn_off
        target:
          area_id: henry_s_room
- id: '1640023160697'
  alias: Front Door - Bell
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door_protect_doorbell
    to: 'on'
  condition: []
  action:
  - service: media_player.play_media
    target:
      entity_id: media_player.front_door_protect_speaker
    data:
      media_content_type: music
      media_content_id: https://quicksounds.com/uploads/tracks/1759518219_656234714_1828201613.mp3
  mode: single
- id: '1641050133796'
  alias: Entryway Hall Light Switch Double Tap
  description: ''
  use_blueprint:
    path: kpine/ge_double.yaml
    input:
      device: 2ac64cb1a200b66dbf268c0d475ed532
      double_tap_on:
      - service: light.turn_on
        target:
          area_id:
          - entryway
          - dining_room
      double_tap_off:
      - service: light.turn_off
        target:
          area_id:
          - dining_room
          - entryway
- id: '1641313962210'
  alias: Weather Image Downloader
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
  condition: []
  action:
  - repeat:
      while:
      - alias: Loop images to download
        condition: template
        value_template: '{{ repeat.index <= images|length }}'
      sequence:
      - service: downloader.download_file
        data:
          url: '{{ images[repeat.index - 1][''url''] }}'
          filename: '{{ images[repeat.index - 1][''entity_id''] }}'
          overwrite: true
      - service: local_file.update_file_path
        data:
          entity_id: '{{ images[repeat.index - 1][''entity_id''] }}'
          file_path: /config/www/{{ images[repeat.index - 1]['entity_id'] }}
  mode: single
  variables:
    images:
    - url: '{{ states(''input_text.url_weather_local_doplar'') }}'
      entity_id: camera.weather_local_doplar
    - url: '{{ states(''input_text.url_weather_local_forecast'') }}'
      entity_id: camera.weather_local_forecast
    - url: '{{ states(''input_text.url_weather_noaa_us_east_coast'') }}'
      entity_id: camera.weather_noaa_us_east_coast
    - url: '{{ states(''input_text.url_weather_noaa_us_southeast'') }}'
      entity_id: camera.weather_noaa_us_southeast
    - url: '{{ states(''input_text.url_weather_noaa_us_continent'') }}'
      entity_id: camera.weather_noaa_us_continent
- id: '1641679968022'
  alias: Powder Room Activity
  description: ''
  use_blueprint:
    path: jlaska/on_off_with_motion_illuminance_timeout.yaml
    input:
      motion_sensor: binary_sensor.powder_room_motion_occupancy
      target_entity: light.powder_room_light
      no_motion_wait: input_number.time_in_minutes_automation_waits_to_turn_off_after_no_motion
- id: '1641844323492'
  alias: Front Door Protect - Person Notification
  description: ''
  use_blueprint:
    path: briis/push_notification_smart_event.yaml
    input:
      smart_entity: sensor.front_door_protect_detected_object
      send_mobile: true
      notify_target_app: mobile_app_james_iphone
      cooldown: 120
      base_image_url: https://homeassistant.jlaska.com
      lovelace_view: /lovelace-cameras/front-door-protect
      silence_timer: 15
      objects: person
