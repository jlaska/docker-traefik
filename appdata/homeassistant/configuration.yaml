
# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Text to speech
tts:
  - platform: google_translate

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

homeassistant:
  customize: !include customize.yaml

# Include themes directory
frontend:
  themes: !include_dir_merge_named themes

logger:
  default: warn

# LFX UDP broadcast isn't working on my network
lifx:
  light:
    - broadcast: !secret lifx_mini_ip
    - broadcast: !secret lifx_z_1_ip
    - broadcast: !secret lifx_z_2_ip

sensor:
  - platform: template
    sensors:
      # Create a virtual lux sensor
      solar_luminance:
        friendly_name: "Solar Luminance"
        icon_template: "mdi:brightness-auto"
        unit_of_measurement: lx
        value_template: "{{ states('sensor.solaredge_current_power') }}"
        device_class: illuminance
      # Create several time/date sensors for use in dashboards
      time_hhmm:
        friendly_name: "Time (hh:mm)"
        icon_template: mdi:calendar-clock
        value_template: "{{ as_timestamp(states('sensor.date_time_iso')) | timestamp_custom('%-I:%M %p') }}"
      my_date:
        friendly_name: "Date (friendly)"
        icon_template: mdi:calendar
        value_template: "{{ as_timestamp(states('sensor.date_time_iso')) | timestamp_custom('%A, %B %d') }}"
      # https://community.home-assistant.io/t/automation-shower-detection-trigger-when-humidity-increases-in-10-minutes/162250/2
      master_bathroom_humidity_delta:
        friendly_name: "Master Bathroom Humidity Delta"
        value_template: "{{ '%0.2f'| format(((states.sensor.lumi_lumi_weather_humidity.state|float - states.sensor.upstairs_humidity.state|float) / states.sensor.upstairs_humidity.state|float) * 100) }}"
        device_class: "humidity"
        unit_of_measurement: '%'

  # Create time sensors
  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'date_time'
      - 'date_time_iso'
      - 'time_date'

binary_sensor:
  # Create humidistat sensors (https://github.com/basschipper/homeassistant-generic-hygrostat)
  - platform: generic_hygrostat
    name: Master Bathroom Hygrostat
    sensor: sensor.lumi_lumi_weather_humidity
    delta_trigger: 3 # Optional humidity swing to detect. Default = 3
    target_offset: 3 # Optional dehumidification target offset. Default = 3
    max_on_time: 7200 # Optional safety max on time in seconds. Default = 7200 seconds
    sample_interval: 300 # Optional time between taking humidity samples in seconds, default 300 seconds
    min_humidity: 30 # Optional minimum humidity to enable dehumidification. Default = 0

light:
  # Combine multiple lights into one
  - platform: group
    name: Living Room Bookshelf
    entities:
      - light.living_room_bookshelf_left
      - light.living_room_bookshelf_right

  # Convert switches to a light
  - platform: switch
    name: Back Door Light
    entity_id: switch.back_door_light_switch
  - platform: switch
    name: Back Spot Light
    entity_id: switch.back_spot_light_switch
  - platform: switch
    name: Entryway Door Light
    entity_id: switch.entryway_door_light_switch
  - platform: switch
    name: Entryway Hall Light
    entity_id: switch.entryway_hall_light_switch
  - platform: switch
    name: Front Door Light
    entity_id: switch.front_door_light_switch
  - platform: switch
    name: Front Spot Light
    entity_id: switch.front_spot_light_switch
  - platform: switch
    name: Garage Exterior Light
    entity_id: switch.garage_exterior_light_switch
  - platform: switch
    name: Garage Light
    entity_id: switch.garage_light_switch
  - platform: switch
    name: Garage Work Light
    entity_id: switch.garage_work_light_switch
  - platform: switch
    name: Guest Bathroom Light
    entity_id: switch.guest_bathroom_light_switch
  - platform: switch
    name: Guest Room Fan Light
    entity_id: switch.guest_room_fan_light_switch
  - platform: switch
    name: Guest Room Nightstand
    entity_id: switch.guest_room_nightstand_switch
  - platform: switch
    name: Henry's Room Fan Light
    entity_id: switch.henrys_room_fan_light_switch
  - platform: switch
    name: Holiday Lights
    entity_id: switch.holiday_light_switch
  - platform: switch
    name: Kids Bathroom Light
    entity_id: switch.kids_bathroom_light_switch
  - platform: switch
    name: Kitchen Table Light
    entity_id: switch.kitchen_table_light_switch
  - platform: switch
    name: Laundry Room Light
    entity_id: switch.laundry_room_light_switch
  - platform: switch
    name: Living Room Fan Light
    entity_id: switch.living_room_fan_light_switch
  - platform: switch
    name: Master Bathroom Light
    entity_id: switch.master_bathroom_light_switch
  - platform: switch
    name: Master Bathroom Shower Light
    entity_id: switch.master_bathroom_shower_light_switch
  - platform: switch
    name: Master Bedroom Fan Light
    entity_id: switch.master_bedroom_fan_light_switch
  - platform: switch
    name: Master Bedroom Nightstand
    entity_id: switch.master_bedroom_nightstand_switch
  - platform: switch
    name: Mudroom Light
    entity_id: switch.mudroom_light_switch
  - platform: switch
    name: Sunroom Fan Light
    entity_id: switch.sunroom_fan_light_switch
  - platform: switch
    name: William's Room Fan Light
    entity_id: switch.williams_room_fan_light_switch

# Fix GE dimmer switch polling
zwave:
  usb_path: /dev/ttyUSB0                                                                                                           
  network_key: !secret zwave_network_key
  device_config:
    light.master_bedroom_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.dining_room_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.kitchen_cabinet_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.kitchen_island_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.kitchen_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.living_room_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4
    light.williams_room_light_level:
      refresh_value: true
      polling_intensity: 1
      delay: 4

# Google Nest Integration
nest:
  client_id: !secret google_client_id
  client_secret: !secret google_client_secret
  project_id: !secret google_project_id
  subscriber_id: !secret google_subscriber_id

# Use camera plugin for forcast/doplar images
camera:
  - platform: generic
    still_image_url: !secret weather_doplar_url
    name: Weather Doplar Radar
  - platform: generic
    still_image_url: !secret weather_forecast_url
    name: Weather 7 Day Forecast
